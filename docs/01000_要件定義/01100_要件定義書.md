# VS Code Language Model Tool API を活用した Azure Databricks ナレッジベース連携システム 要件定義書

<br>

# 文書情報
---
* **文書名**: VS Code LM Tools × Azure Databricks ナレッジベース連携システム 要件定義書
* **作成日**: 2025年9月1日
* **更新日**: 2025年9月1日
* **バージョン**: 1.0
* **作成者**: システム開発チーム

<br>

# 1. プロジェクト概要
---

## 1.1 背景
現在、社内ナレッジベースとして Azure Databricks を活用しているが、開発者が GitHub Copilot を使用する際に、このナレッジベースの情報を効率的に参照できていない状況にある。開発者は別途ブラウザで Databricks にアクセスして情報を検索する必要があり、開発効率の低下を招いている。

## 1.2 目的
VS Code の Language Model Tool API を活用して、GitHub Copilot の Agent モードから直接 Azure Databricks のナレッジベースを検索・参照可能にし、開発効率の向上とナレッジの有効活用を実現する。

## 1.3 プロジェクトスコープ

### 対象範囲
- VS Code 内での GitHub Copilot Agent モードからの Databricks ナレッジベース検索
- 検索専用アクセス（読み取りのみ）
- セキュアな認証・認可機構
- 企業ガバナンス対応

### 対象外
- データの生成・更新機能
- VS Code 以外のエディタ対応
- Databricks ナレッジベースの構築・管理

<br>

# 2. システム要件
---

## 2.1 機能要件

### 2.1.1 ナレッジベース検索機能
- **FR-001**: GitHub Copilot Agent モードから Azure Databricks のナレッジベースを検索できること
- **FR-002**: 検索結果にタイトル、概要、ソースURL、関連テキストが含まれること
- **FR-003**: 検索結果を基に Copilot が引用元を明記した回答を生成できること
- **FR-004**: 明示的なツール呼び出しに対応すること
- **FR-005**: Agent モードでの自動ツール選択に対応すること

### 2.1.2 セキュリティ機能
- **FR-006**: 検索専用アクセス（データの変更・削除は不可）であること
- **FR-007**: OAuth2 認証による安全なアクセス制御を実装すること
- **FR-008**: アクセスログの記録・監査機能を提供すること
- **FR-009**: ツール実行時に確認ダイアログを表示すること
- **FR-010**: 企業ポリシーによる利用制御に対応すること

### 2.1.3 運用管理機能
- **FR-011**: 組織管理者による拡張の許可リスト管理に対応すること
- **FR-012**: レート制御機能を提供すること
- **FR-013**: キャッシュ機能による同一クエリの効率化を実装すること
- **FR-014**: PII・秘匿情報のマスキング機能を提供すること

### 2.1.4 Databricks API利用要件
- **FR-015**: ナレッジベース検索は Databricks SQL Statement Execution API のハイブリッドモード（`wait_timeout=10s`, `on_wait_timeout=CONTINUE`）で実行すること
- **FR-016**: 25MiB を超える結果は `disposition=EXTERNAL_LINKS` とし、SAS URL から結果を取得する際は Authorization ヘッダーを送信しないこと
- **FR-017**: Real-Time Serving Endpoints API を利用してモデル推論結果を取得できること
- **FR-018**: Vector Search の Indexes API を利用して類似検索を実行できること（Endpoints API はインデックスをホストする計算リソース管理に使用）
- **FR-019**: Databricks SQL Queries API を利用して保存済みクエリを実行できること
- **FR-020**: Genie API を利用して会話形式の BI クエリを開始できること
- **FR-021**: Gateway API は Databricks API リファレンスと同一のエンドポイントを提供し、機能対応を 1 対 1 とすること
- **FR-022**: 利用可能なクエリID・インデックス名・GenieスペースID・Serving Endpoint名は LM Tools 側で定義し、その定義に基づき Gateway API を通じて適切な Databricks API を呼び出すこと
- **FR-023**: Gateway API は認証情報の付与とリクエスト転送のみを行い、Databricks API のレスポンスを変更せずに返却すること

## 2.2 非機能要件

### 2.2.1 性能要件
- **NFR-001**: 検索レスポンス時間は5秒以内であること
- **NFR-002**: 同時接続ユーザー数は100名まで対応すること
- **NFR-003**: システム可用性は99.5%以上であること

### 2.2.2 セキュリティ要件
- **NFR-004**: 通信はすべてHTTPS（TLS 1.2以上）で暗号化すること
- **NFR-005**: アクセスログは最低1年間保持すること
- **NFR-006**: 個人情報を含むログはハッシュ化して保存すること
- **NFR-007**: WAF・IP制限による境界防御を実装すること

### 2.2.3 運用要件
- **NFR-008**: 管理者による設定変更は即座に反映されること
- **NFR-009**: システム監視・アラート機能を提供すること
- **NFR-010**: 障害時の自動復旧機能を実装すること